@model HabitsCurrentWeekVM
<head>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>

<body>
    @if (Model.habits.Count > 0)
    {
        <h2 class="py-2 m-2">Your habits - current week </h2>
    }
    @if (Model.habits.Count == 0)
    {
        <h5 class="py-2 m-2">You didn't register any habit for this week</h5>
    }
    <a asp-controller="Habit" asp-action="Create" class="btn btn-primary  m-2">
        Create New Habit
    </a>
    <a asp-controller="Habit" asp-action="ChooseHabits" class="btn btn-primary m-2">
        Choose habits from the list
    </a>
    @if (Model.habits.Count == 0 && Model.habitsHasAnyData == true)
    {
        <a asp-controller="Habit" asp-action="CreateHabitsFromPreviousWeek" class="btn btn-primary m-2">
            Would you like to continue habits from your previous week?
        </a>
    }
    @if (Model.habits.Count > 0)
    {
        <table class="table table-bordered container-lg" style="text-align: center">
            <thead>
                <tr>
                    <th style="width:20%">Habit Name</th>
                    <th style="width:8%">Monday</th>
                    <th style="width:8%">Tuesday</th>
                    <th style="width:8%">Wednesday</th>
                    <th style="width:8%">Thursday</th>
                    <th style="width:8%">Friday</th>
                    <th style="width:8%">Saturday</th>
                    <th style="width:8%">Sunday</th>
                    <th style="width:6%">Your goal</th>
                    <th style="width:8%">Edit</th>
                </tr>
            </thead>
            <tbody>

                @foreach (var habit in Model.habits)
                {
                    <tr>
                        <td>@habit.Name</td>

                        @foreach (var obj in habit.habitRealizations)
                        {
                            <td id="@obj.Id" onclick="updateIfExecutedStatus(@obj.Id, @obj.IfExecuted, '@obj.habit.ViewSetting.IconPartiallyDone')" )>

                                <span id="icon-@obj.Id" style="font-size: 1.5rem; color:@habit.ViewSetting.Color;">

                                    @if (obj.IfExecuted == 1)
                                    {
                                        <i class="@habit.ViewSetting.IconDone" style="font-size: 1.5rem; color:@habit.ViewSetting.Color;"></i>
                                    }
                                    else if (obj.IfExecuted == 2)
                                    {
                                        <i class="@habit.ViewSetting.IconPartiallyDone" style="font-size: 1.5rem; color:@habit.ViewSetting.Color;"></i>

                                    }

                                </span>

                                <input type="hidden" id="obj.Id" value="@obj.Id" />

                            </td>

                        }

                        <td>@habit.QuantityPerWeek</td>
                        <td>

                            <a asp-controller="Habit" asp-action="Edit" asp-route-id="@habit.Id" class="btn btn-outline-primary">
                                Edit
                            </a>

                        </td>
                    </tr>
                }


            </tbody>
        </table>
    }
</body>



<script>
    function updateIfExecutedStatus(itemId, ifExecuted, icon) {

        $.ajax({
            type: "GET",
            url: '@Url.Action("UpdateIfExecuted", "HabitRealization")',
            data: { id: itemId },
            success: function (result) {
                // Jeśli operacja się powiodła, możesz wykonać dodatkowe akcje
                console.log("IfExecuted updated successfully");

                if (result.ifExecuted === 1) {
                    $("#icon-" + itemId).html('<i class="' + icon + '-fill"></i>');
                } else if (result.ifExecuted === 2) {
                    $("#icon-" + itemId).html('<i class="' + icon + '"></i>');

                } else
                    $("#icon-" + itemId).html('');

            },
            error: function (xhr, status, error) {
                console.error("Error updating IfExecuted:", error);
            }
        });

    }
</script>